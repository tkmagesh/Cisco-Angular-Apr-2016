<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Bug Tracker</title>
	<style type="text/css">
		section{
			margin-bottom: 10px;
		}
		.closed{
			color : red;
			text-decoration: line-through;
			font-style: italic;
			font-weight: bold;
		}
		span.name, .stats{
			cursor : pointer;
			font-size: 16pt;
		}
		ol{
			width: 300pt;
			list-style: none;
		}
		li{
			margin-bottom: 5px;
			border : 1px solid gray;
			background-color: #e7e7e7;
			border-radius: 4px;
			padding: 5px;
		}
	</style>
	<script type="text/usecases">
		/*
		1. Add a new bug - done
		2. List the bugs - done
		3. Toggle the closed status of the bug - done
		4. Remove closed bugs - done
		5. Display statistics - done
		6. Search for bugs - done
		7. Sort the bugs - done
		8. Improve the bug display 
		9. Persist the bugs in the localStorage
		10. Display createdAt
		11. Persist the bugs in the server
		12. Categorize the bugs
		13. Allow the user to access a bug using a link
		14. Write unit tests & user acceptance tests
		*/
	</script>
	<script src="angular.js"></script>
	<script>
		var bugTrackerApp = angular.module("bugTrackerApp", []);

		bugTrackerApp.value("appDefaults", {
			bugName : '[Default Bug]'
		})

		
		bugTrackerApp.factory('bugOperations', function(appDefaults){
			var newBugCount = 0;
			return {
				getNewBugCount : function(){
					return newBugCount;
				},
				toggle : function(bug){
					bug.isClosed = !bug.isClosed;
				},
				createNew : function(bugName){
					++this.newBugCount;
					var name = bugName || appDefaults.bugName;
					return {
						name : name,
						isClosed : false
					};
				}
			};
		});
		//bugTrackerApp.value("bugOperations", getBugOperations());

		bugTrackerApp.controller("bugsController", function($scope, bugOperations){
			
			$scope.bugs = [
				{name : "User authentication failure" , isClosed : false},
				{name : "Server communication erratic" , isClosed : false},
				{name : "Object reference not found" , isClosed : false},
			];

			$scope.addNew = function(bugName){
				var newBug = bugOperations.createNew(bugName);
				$scope.bugs.push(newBug);
			};

			$scope.toggle = function(bug){
				bugOperations.toggle(bug);
			};

			$scope.removeClosed = function(){
				for(var i=$scope.bugs.length -1; i>=0; i--)
					if ($scope.bugs[i].isClosed)
						$scope.bugs.splice(i,1);
			};

			$scope.getClosedCount = function(){
				return $scope.bugs.filter(function(bug){
					return bug.isClosed;
				}).length;
			}
		});
	</script>
</head>
<body ng-app="bugTrackerApp">
	<h1>Bug Tracker</h1>
	<div class="content" ng-controller="bugsController">
		<section class="stats">
			<span class="closed">{{getClosedCount()}}</span>
			<span>/</span>
			<!-- <span ng-bind="bugs.length"></span> -->
			<span>{{bugs.length}}</span>
		</section>
		<section class="search">
			<label for="">Search :</label>
			<input type="text" ng-model="searchBug.name">
			<labe>Is Closed ? :</labe>
			<input type="checkbox" ng-model="searchBug.isClosed">
			<input type="button" value="Show All" ng-click="searchBug.isClosed = ''">
		</section>
		<section class="sort">
			<label for="">Order By :</label>
			<!-- <input type="text" ng-model="sortBugBy"> -->
			<select ng-model="sortBugBy">
				<option value="name">Name</option>
				<option value="isClosed">Status</option>
			</select>
			<label for="">Descending ? :</label>
			<input type="checkbox" ng-model="sortBugOrder">
		</section>
		<section class="edit">
			<label for="">Bug Name :</label>
			<input type="text" ng-model="newBugName">
			<input type="button" value="Add New" ng-click="addNew(newBugName)">
			<input type="button" value="Remove Closed" ng-click="removeClosed()">
		</section>
		<section class="list">
			<ol>
				<li ng-repeat="bug in (bugs | filter:searchBug | orderBy:sortBugBy:sortBugOrder)">
					<span class="name" ng-click="toggle(bug)" ng-class="{closed : bug.isClosed}">
						{{bug.name}}
					</span>
				</li>
			</ol>
		</section>
	</div>
</body>
</html>